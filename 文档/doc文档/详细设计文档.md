# NULL&NONE电影院系统详细设计描述文档

## 1. 引言

### 1.1 编制目的

本报告详细完成对电影院系统的详细设计，达到指导后续的目的

### 1.2 词汇表

|    词汇名称     | 词汇含义   | 备注               |
| :-------------: | ---------- | ------------------ |
|    audience     | 观众       |                    |
|     manager     | 经理       |                    |
|     account     | 账户       | 个人电影账户       |
|     signUp      | 注册       |                    |
|      login      | 登陆       |                    |
|       UI        | 界面       |                    |
|       BL        | 逻辑       |                    |
|       DAO       | 数据访问   | 对于数据的增删改查 |
| dataPersistence | 数据持久层 | 数据库数据         |
|     service     | 业务逻辑层 | 具体用例实现       |
|   controller    | 接口控制层 | 客户端交互实现     |

### 1.3 参考资料

1. Null And None电影院系统用例文档 V1.0
2. Null And None电影院系统需求规格说明文档 V1.0
3. Null And None电影院系统体系结构文档 V1.0
3. 丁二玉，刘钦.计算与软件工程（卷二）[M]机械工业出版2012：134—182
4. IEEE std 1471-2000

## 2. 产品描述

参考《Null And None电影院系统》和《Null And None电影院系统需求规格说明文档》中对产品的描述。

## 3. 系统结构设计概述

参考《NULL AND NONE电影院系统》和《NULL AND NONE电影院系统体系结构文档》中对系统结构的描述。

## 4. 结构视角

### 4.1 展示层的分解

##### UserUI模块

类名|功能
---|---
MainFrame | 界面Frame，负责界面的显示和界面的跳转
LoginFrame | 界面Frame，负责登录界面的显示和观众首页界面的跳转
UserUI.RefundFrame | 界面frame，负责观众退票界面的显示和跳转
UserUI.MainFrame | 界面Frame，负责观众主界面的跳转和观众的首页界面的显示
UserUI.MovieDatabaseFrame | 界面Frame，负责电影详情界面的跳转和影库信息的显示
UserUI.FastBookingFrame | 界面Frame，负责观众购票界面的跳转和观众快速购票的显示
UserUI.HelperFrame | 界面Frame，负责观众帮助导航的跳转和观众帮助的显示
UserUI.BuyVIPcardFrame | 界面Frame，负责观众付款界面的跳转和观众会员卡购买的显示
UserUI.CheckVIPcardFrame | 界面Frame，负责观众会员卡导航的跳转和观众查看会员卡相关信息页面的显示
UserUI.VIPcardCostFrame | 界面Frame，负责观众付款界面的跳转和观众会员卡购买的显示
UserUI.HomeFrame | 界面Frame，负责观众导航的跳转和观众个人中心首页的显示
UserUI.ChangeInformationFrame | 界面Frame，负责观众个人中心导航的跳转和观众修改个人信息界面的显示
UserUI.HistoryFrame | 界面Frame，负责观众个人中心导航界面的跳转和观众历史订单的显示
UserUI.CheckDiscountFrame | 界面Frame，负责观众个人中心导航界面的跳转和观众普通优惠信息的显示
UserUI.CheckMarkFrame | 界面Frame，负责观众电影详情的跳转和观众标记电影列表的显示
UserUI.MessageFrame | 界面Frame，负责观众消息界面的显示

-----------------

##### AdministerUI模块

类名 | 功能
---|---
MainFrame | 界面Frame，负责界面的显示和界面的跳转
LoginFrame | 界面Frame，负责登录界面的显示和管理员首页界面的跳转
AdministerUI.PutawayFrame|界面frame，负责管理人员管理电影排
片界面的显示和跳转
SelectFrame|界面frame，负责搜索结果到显示和影片详细信息到跳转
AdministerUI.MainFrame | 界面Frame，负责管理人员主界面的跳转和管理人员的首页界面的显示
AdministerUI.HomeFrame | 界面Frame，负责导航的跳转和管理人员的主界面的显示
AdministerUI.ScheduleFrame | 界面Frame，负责导航的跳转和管理人员管理电影排片界面的显示
AdministerUI.DiscountFrame | 界面Frame，负责导航的跳转和管理人员发布优惠信息的显示
AdministerUI.StatisticFrame | 界面Frame，负责导航的跳转和统计数据的显示

---------------

##### ManagerUI模块

类名 | 功能
---|---
MainFrame | 界面Frame，负责界面的显示和界面的跳转
LoginFrame | 界面Frame，负责登录界面的显示和经理首页界面的跳转
ManagerUI.MainFrame | 界面Frame，负责经理主界面的跳转和经理的首页界面的显示
ManagerUI.HomeFrame | 界面Frame，负责经理导航的跳转和经理的主界面的显示
ManagerUI.DiscountFrame | 界面Frame，负责导航的跳转和经理修改会员优惠策略界面的显示
ManagerUI.RefundFrame | 界面Frame，负责导航的跳转和经理修改观众退改票策略界面的显示
ManagerUI.MovieHallFrame | 界面Frame，负责导航的跳转和经理管理影厅信息界面的显示
ManagerUI.RoleFrame | 界面Frame，负责导航的跳转和经理修改影院角色界面的显示

--------------

##### ManagerUI模块

类名 | 功能
---|---
HomeFrame|总经理主界面的显示和界面的跳转
RecordUI.RecordFrame|经营情况表单查看界面
RecordUI.SaleDetailFrame|销售明细表查看界面
RecordUI.SaleHistoryFrame|经营历程表查看界面
RecordUI.SaleStateFrame|经营情况表的查看界面
PromotionUI.PromotionFrame|总经理促销策略制定的界面
PromotionUI.GiftPromotionFrame|总经理制定赠品促销策略界面
PromotionUI.TotalPromotionFrame|总经理制定总额特价促销策略界面
PromotionUI.TotalGiftPromotionFrame|总经理制定总额赠送促销策略界面
PromotionUI.CouponPromotionFrame|总经理制定代金券促销策略界面
CheckUI.CheckFrame|总经理审批单据界面

---------------

### 4.2 业务逻辑层的分解

#### 4.2.1 movieBL模块

#### 4.2.1.1 模块概述

movieBL模块承担观众查看详细电影信息、标记想看电影、查看排片信息和管理员上架电影等功能需求以及相关非功能需求。
movieBL模块的职责及接口参见软件系统结构描述文档。

#### 4.2.1.2 整体结构

根据体系结构的设计，采用分层风格，将系统分为展示层，业务逻辑层，数据层。每一层之间为了灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加了BussinessLogicService.movieBLService.MovieBLService接口。业务逻辑层和数据层之间添加DataService.movieDataService.MovieDataService接口，为了隔离业务逻辑职责和逻辑控制职责，我们添加了MovieBLController，这样MovieBLController会将对电影相关的逻辑处理交给Movie对象。movieInfoPO、favorListPO、timeslotPO是作为电影信息、想看标记信息和排片信息的持久化对象被添加到设计模型中去的。movieList是容器类。

##### movieBL模块设计图



##### movieBL模块各个类的职责

| 模块              | 职责                                                         |
| ----------------- | ------------------------------------------------------------ |
| MovieBLController | 负责实现电影详情界面、快速购票界面、影库管理界面所需要的服务 |
| Movie             | 电影管理的领域模型对象，拥有电影详细信息、想看标记信息、排片信息和影库信息，可以帮助完成电影详情界面、快速购票界面、影库管理界面所需要的服务 |

#### 4.2.1.3 模块内部类的接口规范

##### MovieBLController的接口规范

<table>
        <tr>
          <td colspan="3">提供的服务（供接口）</td>
        </tr>
        <tr>
          <th rowspan="3">MovieBLController.insertMovieRecord</th>
          <td>语法</td>
          <td>public response insertMovieRecord(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个Movie领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用Movie领域对象的insertMovieRecord方法</td>
        </tr>
        <tr>
          <th rowspan="3">MovieBLController.deleteMovieRecord</th>
          <td>语法</td>
          <td>public response deleteMovieRecord(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个Movie领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用Movie领域对象的deleteMovieRecord方法</td>
        </tr>
        <tr>
          <th rowspan="3">MovieBLController.updateMovieRecord</th>
          <td>语法</td>
          <td>public response updateMovieRecord(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个Movie领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用Movie领域对象的updateMovieRecord方法</td>
        </tr>
        <tr>
          <th rowspan="3">MovieBLController.getMovieInfo</th>
          <td>语法</td>
          <td>public response getMovieInfo(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个Movie领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用Movie领域对象的getMovieInfo方法</td>
        </tr>
        <tr>
          <th rowspan="3">MovieBLController.insertIntoFavorList</th>
          <td>语法</td>
          <td>public response insertIntoFavorList(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个Movie领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用Movie领域对象的insertIntoFavorList方法</td>
        </tr>
        <tr>
          <th rowspan="3">MovieBLController.deleteFromFavorList</th>
          <td>语法</td>
          <td>public response deleteFromFavorList(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个Movie领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用Movie领域对象的deleteFromFavorList方法</td>
        </tr>
        <tr>
          <th rowspan="3">MovieBLController.selectMovieSchedule</th>
          <td>语法</td>
          <td>public response selectMovieSchedule(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个Movie领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用Movie领域对象的selectMovieSchedule方法</td>
        </tr>
</table>
需要的服务（需接口）

| 服务名                    | 服务                   |
| ------------------------- | ---------------------- |
| Movie.insertMovieRecord   | 加入一个电影对象       |
| Movie.deleteMovieRecord   | 删除一个电影对象       |
| Movie.updateMovieRecord   | 修改一个电影对象       |
| Movie.getMovieInfo        | 查找符合要求的电影对象 |
| Movie.insertIntoFavorList | 标记一个电影为想看     |
| Movie.deleteFromFavorList | 取消一个电影的想看标记 |
| Movie.selectMovieSchedule | 查看影片的排片信息     |

##### Movie的接口规范

<table>
        <tr>
          <td colspan="3">提供的服务（供接口）</td>
        </tr>
        <tr>
          <th rowspan="3">Movie.insertMovieRecord</th>
          <td>语法</td>
          <td>public response insertMovieRecord(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>影库中增加一条电影记录</td>
        </tr>
        <tr>
          <th rowspan="3">Movie.deleteMovieRecord</th>
          <td>语法</td>
          <td>public response deleteMovieRecord(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>影库中删除一条电影记录</td>
        </tr>
        <tr>
          <th rowspan="3">Movie.updateMovieRecord</th>
          <td>语法</td>
          <td>public response updateMovieRecord(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>影库中更新一条电影记录</td>
        </tr>
        <tr>
          <th rowspan="3">Movie.getMovieInfo</th>
          <td>语法</td>
          <td>public response getMovieInfo(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>影库中返回一条电影记录</td>
        </tr>
        <tr>
          <th rowspan="3">Movie.insertIntoFavorList</th>
          <td>语法</td>
          <td>public response insertIntoFavorList(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>将对应电影标记为想看</td>
        </tr>
        <tr>
          <th rowspan="3">Movie.deleteFromFavorList</th>
          <td>语法</td>
          <td>public response deleteFromFavorList(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>取消想看标记</td>
        </tr>
        <tr>
          <th rowspan="3">Movie.selectMovieSchedule</th>
          <td>语法</td>
          <td>public response selectMovieSchedule(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>返回排片信息列表</td>
        </tr>
</table>


需要的服务（需接口）

服务名|服务
---|---
MovieData.Movies.add|在数据库中插入一个moviePO对象
MovieData.Movies.delete|在数据库中删除一个moviePO对象
MovieData.Movies.modify|在数据库中修改一个moviePO对象
MovieData.Movies.find|在数据库中查找一个moviePO对象并返回
MovieData.favorList.add|在数据库中插入一个favorListPO对象
MovieData.favorList.delete|在数据库中删除一个favorListPO对象
TheaterData.timeSlot.find|在数据库中修改一个timeslotPO对象

#### 4.2.1.4 业务逻辑层的动态模型

下图分别表明了管理员进行影片管理，观众进行标记想看电影、查看排片信息时，业务逻辑处理的相关对象之间的协作。

影片管理顺序图

标记想看顺序图

查看排片信息顺序图

#### 4.2.1.5 业务逻辑层的设计原理

利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象

------

#### 4.2.2 userBL模块

#### 4.2.2.1 模块概述

userBL模块承担用户登录、注册、登出、个人信息管理和经理管理影院角色等功能需求以及相关非功能需求。
userBL模块的职责及接口参见软件系统结构描述文档。

#### 4.2.2.2 整体结构

根据体系结构的设计，采用分层风格，将系统分为展示层，业务逻辑层，数据层。每一层之间为了灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加了BussinessLogicService.userBLService.UserBLService接口。业务逻辑层和数据层之间添加DataService.userDataService.UserDataService接口，为了隔离业务逻辑职责和逻辑控制职责，我们添加了UserBLController，这样UserBLController会将与用户相关的逻辑处理交给User、RoleManege和对象。userInfoPO、rolePO、permissionPO、是作为用户信息、角色信息和权限信息的持久化对象被添加到设计模型中去的。

##### userBL模块设计图



##### userBL模块各个类的职责

| 模块             | 职责                                                         |
| ---------------- | ------------------------------------------------------------ |
| UserBLController | 负责实现注册界面、登录界面、系统主界面、个人中心界面和经理界面所需要的服务 |
| User             | 用户管理的领域模型对象，拥有用户信息、权限信息，可以帮助完成个人中心界面、注册界面、登录界面和系统主界面所需要的服务 |
| RoleManage       | 角色管理的领域对象模型，拥有角色映射信息，可以帮助完成个人中心界面、经理界面所需要的服务 |

#### 4.2.2.3 模块内部类的接口规范

##### UserBLController的接口规范

<table>
        <tr>
          <td colspan="3">提供的服务（供接口）</td>
        </tr>
        <tr>
          <th rowspan="3">UserBLController.getUserInfo</th>
          <td>语法</td>
          <td>public response getUserInfo(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个User领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用User领域对象的getUserInfo方法</td>
        </tr>
        <tr>
          <th rowspan="3">UserBLController.updateUserInfo</th>
          <td>语法</td>
          <td>public response updateUserInfo(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个User领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用User领域对象的updateUserInfo方法</td>
        </tr>
        <tr>
          <th rowspan="3">UserBLController.login</th>
          <td>语法</td>
          <td>public JSONObject login(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个User领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用User领域对象的login方法</td>
        </tr>
        <tr>
          <th rowspan="3">UserBLController.logout</th>
          <td>语法</td>
          <td>public void logout(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个User领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用User领域对象的logout方法</td>
        </tr>
        <tr>
          <th rowspan="3">UserBLController.register</th>
          <td>语法</td>
          <td>public response register(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个User领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用User领域对象的register方法</td>
        </tr>
        <tr>
          <th rowspan="3">UserBLController.getRoleList</th>
          <td>语法</td>
          <td>public response getRoleList(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个RoleManage领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用RoleManage领域对象的getRoleList方法</td>
        </tr>
        <tr>
          <th rowspan="3">UserBLController.updateRole</th>
          <td>语法</td>
          <td>public response updateRole(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>已创建一个RoleManage领域对象</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用RoleManage领域对象的updateRole方法</td>
        </tr>
</table>

需要的服务（需接口）

| 服务名                        | 服务               |
| ----------------------------- | ------------------ |
| UserBL.User.getUserInfo       | 查看用户个人信息   |
| UserBL.User.updateUserInfo    | 更新用户个人信息   |
| UserBL.User.login             | 用户登录           |
| UserBL.User.logout            | 用户登出           |
| UserBL.User.register          | 用户注册           |
| UserBL.RoleManage.getRoleList | 查看用户的角色信息 |
| UserBL.RoleManage.updateRole  | 更新用户的角色信息 |

##### UserBL的接口规范

<table>
        <tr>
          <td colspan="3">提供的服务（供接口）</td>
        </tr>
        <tr>
          <th rowspan="3">UserBL.User.getUserInfo</th>
          <td>语法</td>
          <td>public response getUserInfo(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>在数据库中查询并返回对应用户的信息</td>
        </tr>
        <tr>
          <th rowspan="3">UserBL.User.updateUserInfo</th>
          <td>语法</td>
          <td>public response updateUserInfo(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>数据库中更新对应的用户信息</td>
        </tr>
        <tr>
          <th rowspan="3">UserBL.User.login</th>
          <td>语法</td>
          <td>public JSONObject login(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>数据库中检验用户名是否存在、用户名与密码是否匹配，返回json对象</td>
        </tr>
        <tr>
          <th rowspan="3">UserBL.User.logout</th>
          <td>语法</td>
          <td>public void logout(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <th rowspan="3">UserBL.User.register</th>
          <td>语法</td>
          <td>public response register(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>将用户基本信息插入数据库</td>
        </tr>
        <tr>
          <th rowspan="3">UserBL.RoleManage.getRoleList</th>
          <td>语法</td>
          <td>public response getRoleList(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>返回用户的角色信息</td>
        </tr>
        <tr>
          <th rowspan="3">UserBL.RoleManage.updateRole</th>
          <td>语法</td>
          <td>public response updateRole(request)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>无</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>数据库中更新用户角色信息</td>
        </tr>
</table>

需要的服务（需接口）

| 服务名                     | 服务                                     |
| -------------------------- | ---------------------------------------- |
| UserData.userInfo.add      | 在数据库中插入一个userInfo对象           |
| UserData.userInfo.delete   | 在数据库中删除一个userInfo对象           |
| UserData.userInfo.find     | 在数据库中查找一个userInfo对象并返回     |
| UserDate.userInfo.update   | 在数据库中修改一个userInfo对象           |
| UserDate.user.find         | 在数据库中查找一个userPO对象并返回       |
| UserDate.user.add          | 在数据库中插入一个userPO对象             |
| UserDate.role.add          | 在数据库中插入一个rolePO对象             |
| UserDate.role.delete       | 在数据库中删除一个rolePO对象             |
| UserDate.role.update       | 在数据库中修改一个rolePO对象             |
| UserDate.role.find         | 在数据库中查找一个rolePO对象并返回       |
| UserDate.permission.add    | 在数据库中插入一个permissionPO对象       |
| UserDate.permission.delete | 在数据库中删除一个permissionPO对象       |
| UserDate.permission.update | 在数据库中修改一个permissionPO对象       |
| UserDate.permission.find   | 在数据库中查找一个permissionPO对象并返回 |

#### 4.2.2.4 业务逻辑层的动态模型

下图分别表明了库存管理人员进行商品管理、商品分类管理、库存查看和库存盘点、库存类单据填写时，业务逻辑处理的相关对象之间的协作。

影片管理顺序图

标记想看顺序图

查看排片信息顺序图

#### 4.2.2.5 业务逻辑层的设计原理

利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象

#### 4.2.3 MovieCountBL

#### 4.2.3.1 模块描述

MovieCountBL模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。

MovieCountBL模块的职责及接口参见软件系统结构描述文档。

#### 4.2.3.2 整体结构

根据体系结构的设计，采用分层风格，将系统分为展示层，业务逻辑层，数据层。每一层之间为了灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加了BussinessLogicService.CustomerBLService.CustomerBLService接口。业务逻辑层和数据层之间添加DataService.CustomerDataService.CustomerDataService接口，为了隔离业务逻辑职责和逻辑控制职责，我们添加了CustomerBLController，这样CustomerBLController会将对客户管理的逻辑处理交给CustomerBL对象。CustomerPO是作为客户信息的持久化对象被添加到设计模型中去的CustomerLineItem保有应收应付等客户数据，依赖于ManifestInfo和ReciptInfo接口。

##### MovieCountBL模块设计图

![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/MovieCountBL%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.png)

##### MovieCountBL模块各个类的职责

| 模块                   | 职责                                                         |
| ---------------------- | ------------------------------------------------------------ |
| MovieCountBLController | 负责实现数据统计界面、上座率计算、电影院统计界面所需要的服务 |
| PriceBL                | 场次统计管理的领域模型对象，拥有相关电影信息、时间信息，可以帮助完成上座率计算、数据统计所需要的服务 |
| MovieFavorBL           | 电影统计管理的领域模型对象，可以帮助完成电影数据统计所需要的服务 |
| SlotRateBL             | 电影院统计管理的领域模型对象，拥有电影院统计记录，可以帮助完成电影院统计界面所需要的服务 |

#### 4.2.3.3 模块内部类的接口规范

<html>

<table>
    <tr>
            <td colspan="3">提供的服务（供接口）</td>
        </tr>
        <tr>
          <th rowspan="3">MovieCountBLController.getTotalSelling</th>
          <td>语法</td>
          <td>public void getTotalSelling(MovieVO vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>电影票房领域对象存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用电影票房领域对象的check()方法</td>
        </tr>
    	<tr>
          <th rowspan="3">MovieCountBLController.getMostPopuparMovie</th>
          <td>语法</td>
          <td>public void getMostPopuparMovie(movieVo vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>电影欢迎领域对象存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用电影欢迎领域对象的check()方法</td>
        </tr>
    	<tr>
          <th rowspan="3">MovieCountBLController.getAvePrice</th>
          <td>语法</td>
          <td>public void getAvePrice(avePriceVo vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>客单价领域对象存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用客单价领域对象的check()方法</td>
        </tr>
    	<tr>
          <th rowspan="3">MovieCountBLController.getSlotRate</th>
          <td>语法</td>
          <td>public void getSlotRate(slotRateVo vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>排片率领域对象存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用排片率领域对象的check()方法</td>
        </tr>    

</table>

</html>

##### 需要的服务

| 服务名                           | 服务             |
| -------------------------------- | ---------------- |
| MovieSelling.getTotalSelling     | 得到电影票房     |
| PopuparMovie.getMostPopuparMovie | 得到最受欢迎电影 |
| AvePrice.getAvePrice             | 得到客单价       |
| SlotRate.getSlotRate             | 得到上座率       |

##### 接口规范

##### 需要的服务

| 服务名                                        | 服务                             |
| --------------------------------------------- | -------------------------------- |
| StaticalData.MovieSelling.getTotalSelling     | 在数据库中查找票房PO对象         |
| StaticalData.PopuparMovie.getMostPopuparMovie | 在数据库中查找最受欢迎电影PO对象 |
| StaticalData.AvePrice.getAvePrice             | 在数据库中查找客单价PO对象       |
| StaticalData.SlotRate.getSlotRate             | 在数据库中查找上座率PO对象       |

#### 4.2.3.4 业务逻辑层的动态模型

下图分别表明了管理人员进行查找票房、查找最受欢迎电影、查找客单价、查找上座率时，业务逻辑处理的相关对象之间的协作。

##### 查找票房顺序图

![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/MovieCountBL_%E6%9F%A5%E6%89%BE%E7%A5%A8%E6%88%BF%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

##### 查找最受欢迎电影

![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/MovieCountBL_%E6%9F%A5%E6%89%BE%E7%A5%A8%E6%88%BF%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

##### 查找客单价

![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/MovieCountBL_%E6%9F%A5%E6%89%BE%E7%A5%A8%E6%88%BF%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

##### 查找上座率

![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/MovieCountBL_%E6%9F%A5%E6%89%BE%E7%A5%A8%E6%88%BF%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

#### 4.2.3.5 业务逻辑层的设计原理

利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象

#### 4.2.4 StrategyBL

#### 4.2.4.1 模块描述

StrategyBL模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。

StrategyBL模块的职责及接口参见软件系统结构描述文档。

#### 4.2.4.2 整体结构

根据体系结构的设计，采用分层风格，将系统分为展示层，业务逻辑层，数据层。每一层之间为了灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加了BussinessLogicService.CustomerBLService.CustomerBLService接口。业务逻辑层和数据层之间添加DataService.CustomerDataService.CustomerDataService接口，为了隔离业务逻辑职责和逻辑控制职责，我们添加了CustomerBLController，这样CustomerBLController会将对客户管理的逻辑处理交给CustomerBL对象。CustomerPO是作为客户信息的持久化对象被添加到设计模型中去的CustomerLineItem保有应收应付等客户数据，依赖于ManifestInfo和ReciptInfo接口。

##### StrategyBL模块设计图

![[https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/StrategyBL_%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.png](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/文档/img/详细设计/StrategyBL_模块设计图.png)](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/StrategyBL_%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1%E5%9B%BE.png)

##### StrategyBL模块各个类的职责

| 模块                 | 职责                                                         |
| -------------------- | ------------------------------------------------------------ |
| StrategyBLController | 负责实现管理会员策略、管理退票策略、管理优惠活动所需要的服务 |
| MemberStrategyBL     | 会员策略管理的领域模型对象，可以帮助完成会员策略管理界面所需要的服务 |
| RefundBL             | 管理退票策略的领域模型对象，可以帮助完成管理退票策略所需要的服务 |
| PreferentialBL       | 管理优惠活动的领域模型对象，拥有优惠策略记录，可以帮助完成界面所需要的服务 |

#### 4.2.4.3 模块内部类的接口规范

<table>
    <tr>
            <td colspan="3">提供的服务（供接口）</td>
        </tr>
        <tr>
          <th rowspan="3">StrategyBLController.getMemberStrategy</th>
          <td>语法</td>
          <td>public void getMemberStrategy(MemberStrategyVO vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>会员策略领域对象存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用会员策略领域对象的check()方法</td>
        </tr>
        <tr>
          <th rowspan="3">StrategyBLController.InsertMemberStrategy</th>
          <td>语法</td>
          <td>public void InsertMemberStrategy(MemberStrategyVO vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>会员策略领域对象还未存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用会员策略领域对象的insert()方法</td>
        </tr>
        <tr>
          <th rowspan="3">StrategyBLController.updateMemberStrategy</th>
          <td>语法</td>
          <td>public void updateMemberStrategy(MemberStrategyVO vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>会员策略领域对象还已存在，修改信息合法</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用会员策略领域对象的update()方法</td>
        </tr>
        <tr>
          <th rowspan="3">StrategyBLController.deleteMemberStrategy</th>
          <td>语法</td>
          <td>public void deleteMemberStrategy(MemberStrategyVO vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>会员策略领域对象还已存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用会员策略领域对象的delete()方法</td>
        </tr>
        <tr>
          <th rowspan="3">StrategyBLController.getRefundStrategy</th>
          <td>语法</td>
          <td>public void getRefundStrategy(RefundStrategyVO vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>退票策略领域对象存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用退票策略领域对象的check()方法</td>
        </tr>
        <tr>
          <th rowspan="3">StrategyBLController.InsertRefundStrategy</th>
          <td>语法</td>
          <td>public void InserRefundStrategy(RefundStrategyVO vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>退票策略领域对象还未存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用退票策略领域对象的insert()方法</td>
        </tr>
        <tr>
          <th rowspan="3">StrategyBLController.updateRefundStrategy</th>
          <td>语法</td>
          <td>public void updateRefundStrategy(RefundStrategy vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>退票策略领域对象还已存在，修改信息合法</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用退票策略领域对象的update()方法</td>
        </tr>
        <tr>
          <th rowspan="3">StrategyBLController.deleteRefundStrategy</th>
          <td>语法</td>
          <td>public void deleteRefundStrategy(RefundStrategy vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>退票策略领域对象还已存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用退票策略领域对象的delete()方法</td>
        </tr>
        <tr>
          <th rowspan="3">StrategyBLController.getPreferentialStrategy</th>
          <td>语法</td>
          <td>public void getPreferentialStrategy(PreferentialStrategy vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>优惠策略领域对象存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用优惠策略领域对象的check()方法</td>
        </tr>
        <tr>
          <th rowspan="3">StrategyBLController.InsertPreferentialStrategy</th>
          <td>语法</td>
          <td>public void InserPreferentialStrategy(PreferentialStrategy vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>优惠策略领域对象还未存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用优惠策略领域对象的insert()方法</td>
        </tr>
        <tr>
          <th rowspan="3">StrategyBLController.updatePreferentialStrategy</th>
          <td>语法</td>
          <td>public void updatePreferentialStrategy(PreferentialStrategy vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>优惠策略领域对象还已存在，修改信息合法</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用优惠策略领域对象的update()方法</td>
        </tr>
        <tr>
          <th rowspan="3">StrategyBLController.deleteRePreferentialStrategy</th>
          <td>语法</td>
          <td>public void deletePreferentialStrategy(PreferentialStrategy vo)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>优惠策略领域对象还已存在</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>调用优惠策略领域对象的delete()方法</td>
        </tr>

##### 需要的服务

| 服务名                            | 服务         |
| --------------------------------- | ------------ |
| PreferentialStrategyData.get()    | 查找优惠策略 |
| PreferentialStrategyData.insert() | 插入优惠策略 |
| PreferentialStrategyData.update() | 更新优惠策略 |
| PreferentialStrategyData.delete() | 删除优惠策略 |
| MemberStrategyData.get()          | 查找会员策略 |
| MemberStrategyData.insert()       | 插入会员策略 |
| MemberStrategyData.update()       | 更新会员策略 |
| MemberStrategyData.delete()       | 删除会员策略 |
| RefundStrategyData.get()          | 查找退票策略 |
| RefundStrategyData.insert()       | 插入退票策略 |
| RefundStrategyData.update()       | 更新退票策略 |
| RefundStrategyData.delete()       | 删除退票策略 |

#### 4.2.4.4 业务逻辑层的动态模型

下图分别表明了管理人员进行现管理会员策略、管理退票策略、管理优惠活动时，业务逻辑处理的相关对象之间的协作。

##### 管理会员策略顺序图

![[https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/StrategyBL_%E4%BC%9A%E5%91%98%E7%AD%96%E7%95%A5%E7%AE%A1%E7%90%86%E9%A1%BA%E5%BA%8F%E5%9B%BE.png](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/文档/img/详细设计/StrategyBL_会员策略管理顺序图.png)](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/StrategyBL_%E4%BC%9A%E5%91%98%E7%AD%96%E7%95%A5%E7%AE%A1%E7%90%86%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

##### 管理退票策略顺序图

![[https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/StrategyBL_%E9%80%80%E7%A5%A8%E7%AD%96%E7%95%A5%E7%AE%A1%E7%90%86%E9%A1%BA%E5%BA%8F%E5%9B%BE.png](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/文档/img/详细设计/StrategyBL_退票策略管理顺序图.png)](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/StrategyBL_%E9%80%80%E7%A5%A8%E7%AD%96%E7%95%A5%E7%AE%A1%E7%90%86%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

##### 管理优惠策略顺序图

![](<https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/文档/img/详细设计/StrategyBL_优惠策略管理顺序图.png>)

#### 4.2.4.5 业务逻辑层的设计原理

利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象

#### 4.2.5  MemberBL模块
#### 4.2.5.1 模块概述
MemberBL模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。
MemberBL模块的职责及接口参见软件系统结构描述文档。
#### 4.2.5.2 整体结构
根据体系结构的设计，采用分层风格，将系统分为展示层，业务逻辑层，数据层。每一层之间为了灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加了Businesslogicservice.memberblservice.MemberBLService接口。业务逻辑层和数据层之间添加Dataservice.memberdataservice.MemberDataService接口.为了隔离业务逻辑职责和逻辑控制职责，我们添加了MemberController。这样，MemberController会将对会员的业务逻辑处理交给Member对象。MemberPO是作为销售记录的持久化对象被添加到设计模型中去的。MemberItem存储MemberId，余额的数据，MemberList封装了关于MemberList的数据集合的数据结构
##### MemberBL模块设计图

![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/MemberBL%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1.png)

##### MemberBL模块各个类的职责

模块|职责
---|---
MemberController|负责实现会员界面所需要的服务
Member|会员的领域模型对象，可以帮助完成会员界面所需要的服务

#### 4.2.5.3 模块内部类的接口规范
##### MemberController的接口规范
<html>
  <table>
    <tr>
      <td colspan="3">提供的服务（供接口）</td>
    </tr>
    <tr>
      <th rowspan="3">MemberController.addMember</th>
      <td>语法</td>
      <td>public void addMember(string id)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>已创建一个Member领域对象</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>调用Member领域对象的addMember方法</td>
    </tr>
    <tr>
      <th rowspan="3">MemberController.memberRecharge</th>
      <td>语法</td>
      <td>public MemberItem memberRecharge(string id, int money)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>已创建一个Member领域对象</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>调用Member领域对象的MemberRecharge方法</td>
    </tr>
    <tr>
      <th rowspan="3">MemberController.seekMember</th>
      <td>语法</td>
      <td>public void seekMember(string id)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>已创建一个Member领域对象</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>调用Member领域对象的seekMember方法</td>
    </tr>
  </table>
</html>
需要的服务（需接口）

服务名|服务
---|---
Member.addMember|加入一个会员对象
Member.seekMember|查找一个会员对象
Member.memberRecharge|会员对象充值

##### Member的接口规范
<html>
  <table>
    <tr>
        <td colspan="3">提供的服务（供接口）</td>
    </tr>
    <tr>
      <th rowspan="3">Member.addMember</th>
      <td>语法</td>
      <td>public void addMember(string id)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>无</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>保存新增会员信息</td>
    </tr>
    <tr>
      <th rowspan="3">Member.seekMember</th>
      <td>语法</td>
      <td>public memberItem seekMember(string id)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>无</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>返回查找到的会员信息</td>
    </tr>
    <tr>
      <th rowspan="3">Member.recharge</th>
      <td>语法</td>
      <td>public void memberRecharge(string id, int money)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>无</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>修改所选会员信息中的余额</td>
    </tr>
  </table>
</html>

需要的服务（需接口）

服务名|服务
---|---
MemberDataService.insert(SalesPo po)|插入单一持久化对象
MemberDataService.find(string id)|查找单一持久化对象
MemberDataService.update(SalesPo po)|修改单一持久化对象

#### 4.2.5.4 业务逻辑层的动态模型
下图分别表明了会员相关业务逻辑处理的相关对象之间的协作。

##### 添加会员顺序图
![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/addMember%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
##### 会员充值顺序图
![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/MemberRechage%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
##### 查找会员信息顺序图
![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/seekMember%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

#### 4.2.5.5 业务逻辑层的设计原理
利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象
其他略

----------

#### 4.2.6  MovieTicketBL模块
#### 4.2.6.1 模块概述
MovieTicketBL模块承担的需求参见需求规格说明文档功能需求及相关非功能需求。
MovieTicketBL模块的职责及接口参见软件系统结构描述文档。
#### 4.2.6.2 整体结构
根据体系结构的设计，采用分层风格，将系统分为展示层，业务逻辑层，数据层。每一层之间为了灵活性，我们会添加接口。比如展示层和业务逻辑层之间，我们添加了businesslogicservice.movieTicketblservice.MovieTicketBLService接口。业务逻辑层和数据层之间添加dataservice.movieTicketdataservice.MovieTicketDataService接口.为了隔离业务逻辑职责和逻辑控制职责，我们添加了MovieTicketController。这样,MovieTicketController会将对电影票的业务逻辑处理交给MovieTicket对象。MovieTicketPO是作为销售记录的持久化对象被添加到设计模型中去的。MovieTicketLineItem存储电影票场次、金额、影厅等相关数据，MovieTicketList封装了关于MemberList的数据集合的数据结构
##### MovieTicketServiceBL模块设计图
![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/MovieTicketBL%E6%A8%A1%E5%9D%97%E8%AE%BE%E8%AE%A1.png)

##### MovieTicketServiceBL模块各个类的职责

模块|职责
---|---
MovieTicketController|负责实现电影票相关业务所需要的服务
MovieTicket|电影票的领域模型对象，可以帮助完成电影票相关业务所需要的服务

#### 4.2.6.3 模块内部类的接口规范
##### MovieTicketController的接口规范
<html>
  <table>
    <tr>
      <td colspan="3">提供的服务（供接口）</td>
    </tr>
    <tr>
      <th rowspan="3">MovieTicketController.selectSeat</th>
      <td>语法</td>
      <td>public void selectSeat(string movieId,int[][] position)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>已创建一个MovieTicket领域对象</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>调用MovieTicket领域对象的selectSeat方法</td>
    </tr>
    <tr>
    <tr>
      <th rowspan="3">MovieTicketController.initOrderForm</th>
      <td>语法</td>
      <td>public MovieTicketPO initOrderForm(string movieId,int[][] position)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>已经合法的选择座位</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>调用MovieTicket领域对象的initOrderForm方法</td>
    </tr>
    <tr>
    <tr>
      <th rowspan="3">MovieTicketController.purchaseTicket</th>
      <td>语法</td>
      <td>public void purchaseTicket(string ticketId)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>在15分钟以内生成订单，订单未支付</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>调用MovieTicket领域对象的purchaseTicket方法</td>
    </tr>
    <tr>
      <th rowspan="3">MovieTicketController.returnTicket</th>
      <td>语法</td>
      <td>public void returnTicket(string ticketId)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>订单完成支付，且符合退款条件</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>调用MovieTicket领域对象的returnTicket方法</td>
    </tr>
    <tr>
      <th rowspan="3">MovieTicketController.getTicketHistory</th>
      <td>语法</td>
      <td>public MovieTicketPO[] getTicketHistory(string userId)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>无</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>调用MovieTicket领域对象的getTicketHistory方法</td>
    </tr>
  </table>
</html>

需要的服务（需接口）

服务名|服务
---|---
MovieTicket.selectSeat|修改影厅对象状态
MovieTicket.initOrderForm|新增一个订单对象
MovieTicket.purchaseTicket|修改订单状态为已支付
MovieTicket.returnTicket|修改订单状态为退款
MovieTicket.getTicketHistory|查看订单列表

##### MovieTicket的接口规范
<html>
  <table>
    <tr>
        <td colspan="3">提供的服务（供接口）</td>
    </tr>
    <tr>
      <th rowspan="3">MovieTicket.selectSeat</th>
      <td>语法</td>
      <td>public void selectSeat(string movieId,int[][] position)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>无</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>更改影厅座位信息</td>
    </tr>
    <tr>
      <th rowspan="3">MovieTicket.initOrderForm</th>
      <td>语法</td>
      <td>public MovieTicketPO initOrderForm(string movieId,int[][] position)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>已经合法的选择座位</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>新增订单信息并返回</td>
    </tr>
    <tr>
      <th rowspan="3">MovieTicket.purchaseTicket</th>
      <td>语法</td>
      <td>public void purchaseTicket(string ticketId)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>在15分钟以内生成的未支付的订单</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>跳转到第三方支付，支付完成后修改订单状态</td>
    </tr>
    <tr>
      <th rowspan="3">MovieTicket.returnTicket</th>
      <td>语法</td>
      <td>public void returnTicket(string ticketId)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>订单已支付且符合退款策略</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>修改订单信息为已退款</td>
    </tr>
    <tr>
      <th rowspan="3">MovieTicket.getTicketHistory</th>
      <td>语法</td>
      <td>public MovieTicketPO[] getTicketHistory(string userId)</td>
    </tr>
    <tr>
      <td>前置条件</td>
      <td>无</td>
    </tr>
    <tr>
      <td>后置条件</td>
      <td>返回订单列表信息</td>
    </tr>
  </table>
</html>

需要的服务（需接口）

服务名|服务
---|---
MovieTicketDataService.insert(MovieTicketPO po)|插入单一持久化对象
MovieTicketDataService.getAll(string userId)|查找单一持久化对象
MovieTicketDataService.update(MovieTicketPO po)|修改单一持久化对象

#### 4.2.6.4 业务逻辑层的动态模型
下图分别表明了会员相关业务逻辑处理的相关对象之间的协作。

##### 选座顺序图
![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/movieTicket_%E9%80%89%E5%BA%A7%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
##### 生成订单顺序图
![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/movieTicket_%E7%94%9F%E6%88%90%E8%AE%A2%E5%8D%95%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
##### 购票顺序图
![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/movieTicket_%E8%B4%AD%E7%A5%A8%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
##### 退票顺序图
![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/movieTicket_%E9%80%80%E7%A5%A8%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)
##### 查看历史订单顺序图
![](https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E8%AF%A6%E7%BB%86%E8%AE%BE%E8%AE%A1/MovieTicket_%E6%9F%A5%E7%9C%8B%E5%8E%86%E5%8F%B2%E8%AE%A2%E5%8D%95%E9%A1%BA%E5%BA%8F%E5%9B%BE.png)

#### 4.2.6.5 业务逻辑层的设计原理
利用委托式控制风格，每个界面需要访问的业务逻辑由各自的控制器委托给不同的领域对象，
其他略


### 4.3 数据层的分解

#### 4.3.1  MovieData模块

##### 4.3.1.1 模块概述

负责电影数据的3保存、增、删、改、查服务

##### 4.3.1.2 模块内部类的接口规范

   <table>
        <tr>
            <th colspan="3">提供的服务（供接口）</td>
        </tr>
        <tr>
          <th rowspan="3">MovieData.Movies.add</th>
          <td>语法</td>
          <td>public void add(movieInfoPO po)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库不存在名称、编号相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>增加一个po</td>
        </tr>
        <tr>
          <th rowspan="3">MovieData.Movies.delete</th>
          <td>语法</td>
          <td>public void delete(moiveInfoPO po)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库存在名称、编号相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>删除一个po</td>
        </tr>
        <tr>
          <th rowspan="3">MovieData.Movies.modify</th>
          <td>语法</td>
          <td>public void modify(movieInfoPO po)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库存在名称、编号相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>更新一个po</td>
        </tr>
        <tr>
          <th rowspan="3">MovieData.Movies.find</th>
          <td>语法</td>
          <td>public movieInfoPO find(String moiveID)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库存在相同id的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>根据关键字返回查找结果</td>
        </tr>
        <tr>
          <th rowspan="3">MovieData.Ticket.add</th>
          <td>语法</td>
          <td>public void add(movieTicketPO po)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库不存在名称相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>增加一个po</td>
        </tr>
        <tr>
          <th rowspan="3">MovieData.Ticket.delete</th>
          <td>语法</td>
          <td>public void delete(movieTicketPO po)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库存在名称相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>删除一个po</td>
        </tr>
        <tr>
          <th rowspan="3">MovieData.Ticket.modify</th>
          <td>语法</td>
          <td>public void modify(movieTicketPO po)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库存在名称相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>修改一个po</td>
        </tr>
        <tr>
          <th rowspan="3">MovieData.Ticket.find</th>
          <td>语法</td>
          <td>public iterator<movieTicketPO> find(String ticketID)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库中存在ID相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>返回对应的PO</td>
        </tr>
    </table>

#### 4.3.2 UserData模块

##### 4.3.2.1 模块概述

负责用户数据的保存、增、删、改、查服务

##### 4.3.2.2 模块内部类的接口规范

<table>
		<tr>
          <th rowspan="3">UserData.user.add</th>
          <td>语法</td>
          <td>public void useradd(userPo  po )</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库不存在编号、姓名相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>新增一个Po</td>
        </tr>
        <tr>
          <th rowspan="3">UserData.user.delete</th>
          <td>语法</td>
          <td>public void userdelete(userPo  po )</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库存在编号或者姓名相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>删除一个Po</td>
        </tr>
        <tr>
          <th rowspan="3">UserData.user.modify</th>
          <td>语法</td>
          <td>public userPO usermodify(userPo  po , string id )</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库存在编号或者姓名相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>修改一个Po</td>
        </tr>
        <tr>
          <th rowspan="3">UserData.user.find</th>
          <td>语法</td>
          <td>public iterator<userPo> userfind(string id )</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库存在编号或者姓名相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>返回一个Po信息</td>
        </tr>
    	<tr>
          <th rowspan="3">UserData.role.add</th>
          <td>语法</td>
          <td>public void roleadd(rolePo  po)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库不存在ID、名称相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>新增一个PO</td>
        </tr>
        <tr>
          <th rowspan="3">UserData.role.delete</th>
          <td>语法</td>
          <td>public void roledelete(rolePo  po)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库存在ID或者名称相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>删除一个PO</td>
        </tr>
        <tr>
          <th rowspan="3">UserData.role.modify</th>
          <td>语法</td>
          <td>public void rolemodify(rolePo  po , string id)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库存在ID或者名称相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>修改一个PO</td>
        </tr>
        <tr>
          <th rowspan="3">UserData.role.find</th>
          <td>语法</td>
          <td>public iterator<userPo> rolefind(string id)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库存在ID或者名称相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>返回一个PO信息</td>
        </tr>
</table>

#### 4.3.3 TheaterData模块

##### 4.3.3.1 模块概述

负责电影院数据的保存、增、删、改、查服务

##### 4.3.3.2 模块内部类的接口规范

<table>
 	<tr>
          <th rowspan="3">TheaterData.movieHall.add</th>
          <td>语法</td>
          <td>public void addHall(movieHallPo po)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库不存在相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>数据库新增一个po</td>
        </tr>
        <tr>
          <th rowspan="3">TheaterData.movieHall.delete</th>
          <td>语法</td>
          <td>public void deleteHall(movieHallPo po)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库存在编号相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>数据库删除一个po</td>
        </tr>
        <tr>
          <th rowspan="3">TheaterData.movieHall.modify</th>
          <td>语法</td>
          <td>public void modifyHall(movieHallPo po)</td>
        </tr>
        <tr>
          <td>前置条件</td>
          <td>数据库存在编号相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>数据库更改一个po</td>
        </tr>
        <tr>
          <th rowspan="3">TheaterData.movieHall.find</th>
          <td>语法</td>
          <td>public void findHall(movieHallPo po)</td>
        </tr>
         <tr>
          <td>前置条件</td>
          <td>数据库存在编号相同的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>数据库返回一个po</td>
        </tr>
    	<tr>
          <th rowspan="3">TheaterData.timeSlot.set</th>
          <td>语法</td>
          <td>public void setTimeSlot(timeSlotPo po)</td>
        </tr>
         <tr>
          <td>前置条件</td>
          <td>数据库内存在需要排片的电影</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>数据库增加排片信息timeSlotPO</td>
        </tr>
    	<tr>
          <th rowspan="3">TheaterData.timeSlot.change</th>
          <td>语法</td>
          <td>public void changeTimeSlot(timeSlotPo po)</td>
        </tr>
         <tr>
          <td>前置条件</td>
          <td>数据库内存在对应的PO</td>
        </tr>
        <tr>
          <td>后置条件</td>
          <td>数据库修改排片信息timeSlotPO</td>
        </tr>
</table>

#### 4.3.4 PromotionData模块

##### 4.3.4.1 模块概述

负责商业促销数据的保存、增、删、改、查服务

##### 4.3.4.2 模块内部类的接口规范

<table>
 	<tr>
       <th rowspan="3">PromotionData.preferential.add</th>
       <td>语法</td>
       <td>public void addpreferential(preferentialPo po)</td>
    </tr>
    <tr>
       <td>前置条件</td>
       <td>数据库不存在相同的PO</td>
    </tr>
    <tr>
       <td>后置条件</td>
       <td>数据库新增一个po</td>
    </tr>
    <tr>
       <th rowspan="3">PromotionData.preferential.cancel</th>
       <td>语法</td>
       <td>public void cancelpreferential(preferentialPo po)</td>
    </tr>
    <tr>
       <td>前置条件</td>
       <td>数据库存在对应的PO</td>
    </tr>
    <tr>
       <td>后置条件</td>
       <td>数据库删除一个po</td>
    </tr>
    <tr>
       <th rowspan="3">PromotionData.preferential.find</th>
       <td>语法</td>
       <td>public void cancelpreferential(preferentialPo po)</td>
    </tr>
    <tr>
       <td>前置条件</td>
       <td>数据库存在对应的PO</td>
    </tr>
    <tr>
       <td>后置条件</td>
       <td>数据库返回一个po</td>
    </tr>	
</table>



## 5. 依赖视角
图1和图2是客户端和服务器端各自的包之间的依赖关系

图1：客户端开发包图

![](<https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E7%94%A8%E6%88%B7%E7%95%8C%E9%9D%A2%E7%B1%BB%E5%9B%BE.png>)



图2：服务器端开发包图

![](<https://raw.githubusercontent.com/1071956678lfm/NJUSE-2/master/%E6%96%87%E6%A1%A3/img/%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%AB%AF%E5%BC%80%E5%8F%91%E5%8C%85%E5%9B%BE.png>)
